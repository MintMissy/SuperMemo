<!DOCTYPE html>
<html lang="pl">
<head>
    <title>SuperMEMO</title>
    <meta charset="UTF-8">
</head>
<style>
    body {
        background-color: #333;
    }

    #plansza {
        width: 560px;
        height: 450px;
        background-color: #666;
    }

    .karta {
        width: 100px;
        height: 100px;
        background-color: yellow;
        margin-left: 10px;
        margin-top: 10px;
        float: left;

        font-size: 80px;
        text-align: center;
    }

    .odkryta {
        background-color: aqua;
    }

    #timer {
        font-size: 60px;
        color: white;
    }

    #steps {
        font-size: 60px;
        color: white;
    }

</style>
<body onload="generuj()">
<script type="text/javascript">
    let resetTime;
    let odkryteKarty = [];
    let losoweLiterki = [];
    let points = 0;

    function generuj() {

        let literki = ['♠', '♣', '♥', '♪', '☯', '★', '✿', '✘', '♛', '✔', '♠', '♣', '♥', '♪', '☯', '★', '✿', '✘', '♛', '✔'];

        for (let i = 0; i < 1; i++) {
            let los1 = Math.floor(Math.random() * literki.length);
            let los2 = Math.floor(Math.random() * literki.length);
            [literki[los1], literki[los2]] = [literki[los2], literki[los1]];
        }

        for (let i = 0; i < 20; i++) {
            let los = Math.floor(Math.random() * (literki.length));
            losoweLiterki[i] = literki[los];
            literki.splice(los, 1);
            plansza.innerHTML += '<div id="karta' + i + '" onclick="odkryj(this)" class="karta"></div>';
        }
    }

    let limitOdkryj = false;
    let ostatnioOdkryta;
    let startDate;
    let stepsNumber = 0;

    function odkryj(karta) {

        if (limitOdkryj === true) {
            return 0;
        }

        if (ostatnioOdkryta === karta.id.substr(5)) {
            return 0;
        }

        if (startDate === undefined) {
            startDate = new Date();
            startDate = startDate.getTime();
        }

        ostatnioOdkryta = karta.id.substr(5);

        karta.innerHTML = losoweLiterki[karta.id.substr(5)];
        karta.classList.add('odkryta');
        odkryteKarty[odkryteKarty.length] = karta;

        if (odkryteKarty.length < 2) {
            return 0;
        }

        if (losoweLiterki[odkryteKarty[0].id.substr(5)] === losoweLiterki[odkryteKarty[1].id.substr(5)]) {
            limitOdkryj = true;
            setStep();

            setTimeout(() => {
                odkryteKarty[0].style.visibility = "hidden";
                odkryteKarty[1].style.visibility = "hidden";
                odkryteKarty = [];
                limitOdkryj = false;
                points += 1;
            }, 500)

            return 0;
        }

        if (losoweLiterki[odkryteKarty[0].id.substr(5)] !== losoweLiterki[odkryteKarty[1].id.substr(5)]) {
            limitOdkryj = true;
            setStep();

            setTimeout(() => {
                odkryteKarty[0].innerHTML = "";
                odkryteKarty[0].classList.remove('odkryta');
                odkryteKarty[1].innerHTML = "";
                odkryteKarty[1].classList.remove('odkryta');
                odkryteKarty = [];
                limitOdkryj = false;
                ostatnioOdkryta = undefined;
            }, 800)

            return 0;
        }
    }


    function setTimer() {

        if (startDate === undefined) {
            return 0;
        }

        let currentTime = new Date();
        currentTime = currentTime.getTime();
        timer.innerHTML = "<p>Timer: " + Math.floor((startDate - currentTime) / -1000) + "</p>"
    }

    if (points < 10){
        resetTime = setInterval(setTimer, 1000);
    }

    function setStep(){

        stepsNumber += 1
        steps.innerHTML = "<p>Steps: " + stepsNumber + "</p>"
    }

</script>
<div id="plansza"></div>
<div id="timer"><p>Timer: 0</p></div>
<div id="steps"><p>Steps: 0</p></div>
</body>
</html>
